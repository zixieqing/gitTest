---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pengjixian.
--- DateTime: 2018/10/26 1:56 PM
---
--[[
    付费钻石抽奖确认界面
--]]
local CommonDialog = require('common.CommonDialog')
local DiamondLuckyDrawPopup = class('DiamondLuckyDrawPopup', CommonDialog)

local shareFacade = AppFacade.GetInstance()
local gameMgr = app.gameMgr

function DiamondLuckyDrawPopup:InitialUI()
    local datas = self.args.data
    self.datas = datas
    self.cb = self.args.cb
    local function CreateView()
        -- bg
        local bg = display.newImageView(_res('ui/common/common_bg_7.png'), 0, 0)
        local bgSize = bg:getContentSize()
        -- bg view
        local view = display.newLayer(0, 0, {size = bgSize, ap = cc.p(0.5, 0.5)})
        display.commonUIParams(bg, {po = cc.p(utils.getLocalCenter(view))})
        view:addChild(bg)
        -- title
        local titleBg = display.newButton(0, 0, {n = _res('ui/common/common_bg_title_2.png'), animation = false})
        display.commonUIParams(titleBg, {po = cc.p(bgSize.width * 0.5, bgSize.height - titleBg:getContentSize().height * 0.5 - 3)})
        display.commonLabelParams(titleBg,
                {text = __('幻晶石召唤'),
                 fontSize = fontWithColor('3').fontSize, color = fontWithColor('3').color,
                 font = TTF_GAME_FONT, ttf = true,
                 offset = cc.p(0, -2)})
        bg:addChild(titleBg)

        local textRich = {}
		local userInfo = gameMgr:GetUserInfo()
		if userInfo.paidDiamond > userInfo.diamond then
			userInfo.paidDiamond = userInfo.diamond
		end
        if checkint(datas.consumeNum) <= gameMgr:GetAmountByGoodId(PAID_DIAMOND_ID) then
            local text = string.split(__('你是否要消耗|_price_|个有偿幻晶石,进行|_num_|次召唤?'), '|')
            for i,v in ipairs(text) do
                if '_price_' == v then
                    table.insert( textRich, fontWithColor(16, {text = datas.consumeNum}) )
                elseif '_num_' == v then
                    table.insert( textRich, fontWithColor(16, {text = datas.type}) )
                elseif '' ~= v then
                    table.insert( textRich, fontWithColor(16, {text = v}) )
                end
            end
        else
            table.insert( textRich, fontWithColor(16, {text = __('当前有偿幻晶石不足，是否前往购买？')}) )
        end

        local desrLabel = display.newRichLabel(utils.getLocalCenter(view).x, bgSize.height - 120, {
            w = bgSize.width - 75, h = 250, c = textRich, r = true
        })
        view:addChild(desrLabel)

        local contentBG = display.newImageView(_res('ui/home/commonShop/shop_jp_bg_detail_diamonds.png'), bgSize.width/2, 260)
        view:addChild(contentBG)

        local titleLabel = display.newLabel(bgSize.width/2, 312, fontWithColor(5, {text = __('你拥有：')}))
        view:addChild(titleLabel)

        local freeLabel = display.newLabel(bgSize.width/2 - 4, 268, fontWithColor(5, {text = __('有偿幻晶石：'), ap = cc.p(1, 0.5)}))
        view:addChild(freeLabel)

        local paidLabel = display.newLabel(bgSize.width/2 - 4, 234, fontWithColor(5, {text = __('无偿幻晶石：'), ap = cc.p(1, 0.5)}))
        view:addChild(paidLabel)

        local currencyBG = display.newImageView(_res('ui/home/commonShop/shop_jp_bg_num_diamonds.png'), bgSize.width/2, freeLabel:getPositionY(), {ap = display.LEFT_CENTER})
        view:addChild(currencyBG)

        local currencyBG = display.newImageView(_res('ui/home/commonShop/shop_jp_bg_num_diamonds.png'), bgSize.width/2, paidLabel:getPositionY(), {ap = display.LEFT_CENTER})
        view:addChild(currencyBG)

        local freeDiamondLabel = display.newLabel(bgSize.width/2 + 120, freeLabel:getPositionY(), fontWithColor(18, {text = gameMgr:GetAmountByGoodId(PAID_DIAMOND_ID), ap = cc.p(1, 0.5)}))
        view:addChild(freeDiamondLabel)

        local paidDiamondLabel = display.newLabel(bgSize.width/2 + 120, paidLabel:getPositionY(), fontWithColor(18, {text = gameMgr:GetAmountByGoodId(DIAMOND_ID) - gameMgr:GetAmountByGoodId(PAID_DIAMOND_ID), ap = cc.p(1, 0.5)}))
        view:addChild(paidDiamondLabel)

        local cancelBtn = display.newButton(bgSize.width/2 - 100,74,{
            n = _res('ui/common/common_btn_white_default.png'),
            cb = function(sender)
                PlayAudioByClickClose()
                self:CloseHandler()
            end
        })
        display.commonLabelParams(cancelBtn,fontWithColor(14,{text = __('取消')}))
        view:addChild(cancelBtn)

        -- entry button
        local entryBtn = display.newButton(bgSize.width/2 + 100,74,{
            n = _res('ui/common/common_btn_orange.png'),
            cb = function(sender)
                PlayAudioByClickNormal()
                if checkint(datas.consumeNum) <= gameMgr:GetAmountByGoodId(PAID_DIAMOND_ID) then
                    if self.cb then
                        self.cb()
                    end
                else
                    if GAME_MODULE_OPEN.NEW_STORE then
                        app.uiMgr:showGameStores({storeType = GAME_STORE_TYPE.DIAMOND})
                    else
                        app.router:Dispatch({name = "HomeMediator"}, {name = "ShopMediator"})
                    end
                end
                self:CloseHandler()
            end
        })
        display.commonLabelParams(entryBtn,fontWithColor(14,{text = __('确认')}))
        view:addChild(entryBtn)

        return {
            view        = view,
        }
    end
    xTry(function ( )
        self.viewData = CreateView( )

    end, __G__TRACKBACK__)
end

return DiamondLuckyDrawPopup