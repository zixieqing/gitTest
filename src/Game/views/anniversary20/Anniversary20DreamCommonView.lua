---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xingweihao.
--- DateTime: 2019/10/17 10:40 AM
---

---@class Anniversary20DreamCommonView
local Anniversary20DreamCommonView = class('Anniversary20DreamCommonView', function ()
	local node = CLayout:create(display.size)
	node.name = 'Game.views.anniversary19.Anniversary20DreamCommonView'
	node:setName('Anniversary20DreamCommonView')
	node:enableNodeEvents()
	return node
end)
local newI
local newImageView = display.newImageView
local newLabel = display.newLabel
local newButton = display.newButton
local newLayer = display.newLayer
local RES_DICT = {
	COMMON_BTN_WHITE_DEFAULT          = _res('ui/common/common_btn_white_default.png'),
	COMMON_BTN_ORANGE                 = _res('ui/common/common_btn_orange.png'),
	COM_BACK_BTN                      = _res('ui/common/common_btn_back.png'),
	WONDERLAND_TOWER_TEA_BOX          = _spn('ui/anniversary20/explore/effects/wonderland_tower_tea_box'),
	WONDERLAND_EXPLORE_BG_COMMON      = _res('ui/anniversary20/explore/exploreStep/wonderland_tower_bg_cut.png'),
	WONDERLAND_EXPLORE_GO_LINE_PANEL  = _res('ui/anniversary20/explore/exploreStep/wonderland_explore_go_line_panel.png'),
	WONDERLAND_TOWER_CUT_HEAD         = _res('ui/anniversary20/explore/exploreStep/wonderland_tower_cut_head.png'),
}
local GoodNode = require("common.GoodNode")
function Anniversary20DreamCommonView:ctor( ... )
	self:InitUI()
end


function Anniversary20DreamCommonView:InitUI()

	local view = newLayer(display.cx, display.cy,{ap = display.CENTER, size = display.size})
	self:addChild(view,1)

	local swallowLayer = display.newLayer(display.cx , display.cy , { color = cc.c4b(0,0,0,175) , ap = display.CENTER ,  size = display.size , enable = true})
	self:addChild(swallowLayer)

	local backBtn = ui.button({n = RES_DICT.COM_BACK_BTN , cb = function()
		app:DispatchObservers("ANNIVERSARY_2020_EXPLORE_STEP_CLOSE_EVENT")
	end})
	view:addList(backBtn):alignTo(nil, ui.lt, {offsetX = display.SAFE_L + 35, offsetY = -15  })
	local backBtn = ui.button({n = RES_DICT.COM_BACK_BTN , cb = function()
		app:DispatchObservers("ANNIVERSARY_2020_EXPLORE_STEP_CLOSE_EVENT")
	end})
	view:addList(backBtn):alignTo(nil, ui.lt, {offsetX = display.SAFE_L + 35, offsetY = -15  })


	local centerLayout = newLayer(643, 365,
			{ ap = display.CENTER,size = cc.size(600, 500) })
	centerLayout:setPosition(display.cx + -24, display.cy + -10)
	view:addChild(centerLayout)

	local centerBottomLayout = newLayer(326, 72,
			{ ap = display.CENTER, size = cc.size(700, 200) })
	centerLayout:addChild(centerBottomLayout)

	local centerBottomImage = display.newPathSpine(RES_DICT.WONDERLAND_TOWER_TEA_BOX)
	centerBottomImage:setAnimation(0,"idle" , true)
	self:addChild(centerBottomImage)
	centerBottomImage:setPosition(display.center)
	--centerBottomLayout:addChild(centerBottomImage)

	local centerTopLayout = newLayer(303, 100,
			{ ap = display.CENTER, size = cc.size(400, 400) })
	centerLayout:addChild(centerTopLayout)

	local rightLayout = newLayer(display.SAFE_R +40, display.height/2,
			{ ap = display.RIGHT_CENTER,  size = cc.size(440, 540) })
	view:addChild(rightLayout)

	local rightBgImage = newImageView(RES_DICT.WONDERLAND_EXPLORE_BG_COMMON, 220, 270,
			{ ap = display.CENTER, tag = 55, enable = false, scale9 = true, size = cc.size(440, 540) })
	rightLayout:addChild(rightBgImage)

	--local titleBgImage = display.newImageView(RES_DICT.WONDERLAND_TOWER_CUT_HEAD ,220, 510 )
	--rightLayout:addChild(titleBgImage)
	local titleBtn = newButton(210, 510, { ap = display.CENTER ,  n = RES_DICT.WONDERLAND_TOWER_CUT_HEAD, d = RES_DICT.WONDERLAND_TOWER_CUT_HEAD, s = RES_DICT.WONDERLAND_TOWER_CUT_HEAD, scale9 = true, tag = 56 })
	display.commonLabelParams(titleBtn, {text = "",  offset = cc.p(0 , 5) , fontSize = 24, color = '#e5b156'})
	rightLayout:addChild(titleBtn)

	local descrLabel = newLabel(210, 485,
			{ ap = display.CENTER_TOP, color = '#fbe6c6', text = "", fontSize = 24, tag = 57 , w = 280, hAlign = display.TAL })
	rightLayout:addChild(descrLabel)

	local rightCenterLayout = newLayer(210, 201,
			{ ap = display.CENTER,  size = cc.size(250, 200)})
	rightLayout:addChild(rightCenterLayout)

	local resultLabel = newLabel(125, 165,
			{ ap = display.CENTER, color = '#ff976b', text = "", fontSize = 22, tag = 59 })
	rightCenterLayout:addChild(resultLabel)

	local oneline = newImageView(RES_DICT.WONDERLAND_EXPLORE_GO_LINE_PANEL, 125, 191,
			{ ap = display.CENTER, tag = 60, enable = false })
	rightCenterLayout:addChild(oneline)

	local twoline = newImageView(RES_DICT.WONDERLAND_EXPLORE_GO_LINE_PANEL, 125, 12,
			{ ap = display.CENTER, tag = 61, enable = false })
	rightCenterLayout:addChild(twoline)

	--local goodNode = GoodNode.new({goodsId = DIAMOND_ID , showAmount = true  })
	--rightCenterLayout:addChild(goodNode)
	--goodNode:setPosition(125, 93)
	--goodNode:setOnClickScriptHandler(handler(self, self.ShowRewardsGoodsEffect))
	local goodNodesLayout = display.newLayer(125, 93 ,{
		size = cc.size(130,130) , ap = display.CENTER
	} )
	rightCenterLayout:addChild(goodNodesLayout)
	local leftButton = newButton(120, 56, { ap = display.CENTER ,  n = RES_DICT.COMMON_BTN_WHITE_DEFAULT, d = RES_DICT.COMMON_BTN_WHITE_DEFAULT, s = RES_DICT.COMMON_BTN_WHITE_DEFAULT, scale9 = true, size = cc.size(122, 62), tag = 63 })
	display.commonLabelParams(leftButton, {text = "", fontSize = 24, color = '#414146'})
	rightLayout:addChild(leftButton)

	local rightButton = newButton(320, 56, { ap = display.CENTER ,  n = RES_DICT.COMMON_BTN_ORANGE, d = RES_DICT.COMMON_BTN_ORANGE, s = RES_DICT.COMMON_BTN_ORANGE, scale9 = true, size = cc.size(123, 62), tag = 64 })
	display.commonLabelParams(rightButton, {text = "", fontSize = 24, color = '#414146'})
	rightLayout:addChild(rightButton)
	self:setOpacity(0)
	self:runAction(cc.FadeIn:create(0.5))
	self.viewData = {
		centerLayout            = centerLayout,
		centerBottomLayout      = centerBottomLayout,
		centerBottomImage       = centerBottomImage,
		centerTopLayout         = centerTopLayout,
		rightLayout             = rightLayout,
		rightBgImage            = rightBgImage,
		titleBtn                = titleBtn,
		descrLabel              = descrLabel,
		rightCenterLayout       = rightCenterLayout,
		resultLabel             = resultLabel,
		oneline                 = oneline,
		swallowLayer            = swallowLayer ,
		twoline                 = twoline,
		leftButton              = leftButton,
		goodNodesLayout         = goodNodesLayout,
		rightButton             = rightButton,
	}
end


function Anniversary20DreamCommonView:SetOnlyOneBtn()
	local viewData = self.viewData
	viewData.leftButton:setVisible(false)
	viewData.rightButton:setPositionX(220)
	viewData.rightButton:setVisible(true)
end
function Anniversary20DreamCommonView:SetOnlyLeftOneBtn()
	local viewData = self.viewData
	viewData.leftButton:setVisible(true)
	viewData.leftButton:setPositionX(220)
	viewData.rightButton:setVisible(false)
end
function Anniversary20DreamCommonView:SetTwoBtn()
	local viewData = self.viewData
	viewData.leftButton:setVisible(true)
	viewData.rightButton:setVisible(true)
end

function Anniversary20DreamCommonView:SetRightCenterLayoutVisible(isVisble)
	local viewData = self.viewData
	viewData.rightCenterLayout:setVisible(isVisble)
end

function Anniversary20DreamCommonView:ShowRewardsGoodsEffect(sender)
	local goodId =  sender.goodId
	app.uiMgr:ShowInformationTipsBoard({targetNode = sender, iconId = goodId, type = 1})
end

function Anniversary20DreamCommonView:AddGoodNodes(rewardData)
	local viewData = self.viewData
	viewData.goodNodesLayout:removeAllChildren()
	local nums = #rewardData
	local width = 130
	local layoutSize = cc.size(width*nums , width)
	viewData.goodNodesLayout:setContentSize(layoutSize)
	local GoodNode = require("common.GoodNode")
	for i = 1 , nums do
		local data = clone(rewardData[i])
		data.showAmount = true
		local goodNode = GoodNode.new(data)
		goodNode:setPosition((i-0.5)*width , width/2)
		goodNode:setTag(checkint(data.goodsId))
		ui.bindClick(goodNode , handler(self, self.ShowRewardsGoodsEffect))
		viewData.goodNodesLayout:addChild(goodNode)
	end
end

return Anniversary20DreamCommonView

