---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xingweihao.
--- DateTime: 2018/10/12 3:27 PM
---
---@class AnniversalSaleRecordView
local AnniversalSaleRecordView = class('AnniversalSaleRecordView', function ()
    local node = CLayout:create(display.size)
    node.name = 'Game.views.artifact.AnniversalSaleRecordView'
    node:setName('AnniversalSaleRecordView')
    node:enableNodeEvents()
    return node
end)

local commonLabelParams = display.commonLabelParams
local newLabel = display.newLabel
local newNSprite = display.newNSprite
local newButton = display.newButton
local newLayer = display.newLayer
local RES_DICT = {
    COMMON_BTN_TIPS               = app.anniversaryMgr:GetResPath('ui/common/common_btn_tips.png'),
    ANNI_STALL_BG_PAPER           = app.anniversaryMgr:GetResPath('ui/anniversary/anni_stall_bg_paper.png'),
    COMMON_TITLE_5                = app.anniversaryMgr:GetResPath('ui/common/common_title_5.png'),
    ANNI_STALL_BG_PAPER_BAR       = app.anniversaryMgr:GetResPath('ui/anniversary/anni_stall_bg_paper_bar.png'),
}

function AnniversalSaleRecordView:ctor( param  )
    param = param or {}
    self.logs = param
    local view = newLayer(display.cx, display.cy,{ap = display.CENTER, size = display.size})
    self:addChild(view)
    local closeLayer = newLayer(display.cx , display.cy ,{ap = display.CENTER , color = cc.c4b(0,0,0,175) ,enable = true  , cb = function()
        self:removeFromParent()
    end })
    view:addChild(closeLayer)
    local contentLayer = newLayer(667, 375,
                                  { ap = display.CENTER,  size = cc.size(855, 593)})
    contentLayer:setPosition(display.cx + 0, display.cy + 0)
    view:addChild(contentLayer)

    local bgImage = newNSprite(RES_DICT.ANNI_STALL_BG_PAPER, 0, 0,
                               { ap = display.LEFT_BOTTOM, tag = 25 })
    bgImage:setScale(1, 1)
    contentLayer:addChild(bgImage)

    local titleBtn = newButton(430, 548, { ap = display.CENTER ,  n = RES_DICT.COMMON_TITLE_5, s = RES_DICT.COMMON_TITLE_5, scale9 = true, size = cc.size(186, 31), tag = 26 })
    commonLabelParams(titleBtn,  fontWithColor(16,{text = app.anniversaryMgr:GetPoText(__('售卖记录')), fontSize = 24}))
    contentLayer:addChild(titleBtn)

    local lineImage = newNSprite(RES_DICT.ANNI_STALL_BG_PAPER_BAR, 33, 469,
                                 { ap = display.LEFT_BOTTOM, tag = 27 })

    contentLayer:addChild(lineImage,2)

    local dataLabel = newLabel(95, 494,
                               fontWithColor(6 , { ap = display.CENTER, text = app.anniversaryMgr:GetPoText(__('日期')), fontSize = 24, tag = 36 }))
    contentLayer:addChild(dataLabel)

    local foodName = newLabel(312, 493,
                              fontWithColor(6 , { ap = display.CENTER, text = app.anniversaryMgr:GetPoText(__('售卖食物')), fontSize = 24, tag = 37 }))
    contentLayer:addChild(foodName)

    local priceLabel = newLabel(515, 493,
                                fontWithColor(6 ,  { ap = display.CENTER,  text = app.anniversaryMgr:GetPoText(__('单价')), fontSize = 24, tag = 38 }))
    contentLayer:addChild(priceLabel)

    local sallNum = newLabel(738, 493,
                             fontWithColor(6 ,  { ap = display.CENTER,  text = app.anniversaryMgr:GetPoText(__('销售数量')), fontSize = 24, tag = 38 }))
    contentLayer:addChild(sallNum)
    local tableView = CTableView:create(cc.size(800,396) )
    tableView:setDirection(eScrollViewDirectionVertical)
    tableView:setAnchorPoint( display.CENTER_TOP)
    tableView:setPosition(cc.p(429,469))
    tableView:setCountOfCell(#self.logs)
    tableView:setSizeOfCell( cc.size(800, 58))
    contentLayer:addChild(tableView)
    tableView:setDataSourceAdapterScriptHandler(handler(self, self.OnDataSource))
    tableView:reloadData()
    local tipButton = newButton(578, 41, { ap = display.CENTER ,  n = RES_DICT.COMMON_BTN_TIPS, s = RES_DICT.COMMON_BTN_TIPS, scale9 = true , cb=function()
        app.uiMgr:ShowIntroPopup({moduleId =  -10})
    end})
    commonLabelParams(tipButton, {text = "", fontSize = 14, color = '#414146'})
    contentLayer:addChild(tipButton)

    local desrLabel = newLabel(549, 38,
                               fontWithColor(6,{ ap = display.RIGHT_CENTER, text = app.anniversaryMgr:GetPoText(__("售卖记录每小时更新一次")), fontSize = 24, tag = 46 }))
    contentLayer:addChild(desrLabel)
    return {
        contentLayer            = contentLayer,
        bgImage                 = bgImage,
        titleBtn                = titleBtn,
        lineImage               = lineImage,
        dataLabel               = dataLabel,
        foodName                = foodName,
        priceLabel              = priceLabel,
        sallNum                 = sallNum,
        tableView                = tableView,
        tipButton               = tipButton,
        desrLabel               = desrLabel,
    }
end
function AnniversalSaleRecordView:OnDataSource(cell, idx )
    local index = idx + 1
    if  not  cell  then
        cell = self:CreateTableCell()
    end
    local viewData  = cell.viewData
    xTry(function ( )
        local data = self.logs[index]
        local sellTime = data.sellTime or ""
        local sellNum = data.sellNum
        local recipePrice = data.recipePrice
        local recipeId = data.recipeId
        local parserConfig  = app.anniversaryMgr:GetConfigParse()
        local recipeConfig = app.anniversaryMgr:GetConfigDataByName(parserConfig.TYPE.FOOD_ATTR)
        local recipeName = recipeConfig[tostring(recipeId)] and recipeConfig[tostring(recipeId)].name or ""
         commonLabelParams(viewData.dataeLabel , {text = sellTime})
         commonLabelParams(viewData.foodName , {text = recipeName})
         commonLabelParams(viewData.sallNumLabel , {text = sellNum})
         display.reloadRichLabel(viewData.priceLabel ,  {c = {
             fontWithColor('16',{text = recipePrice}) ,
             {img = CommonUtils.GetGoodsIconPathById(app.anniversaryMgr:GetIncomeCurrencyID()) , scale = 0.2}
         }})
    end, __G__TRACKBACK__)
    return cell
end
function AnniversalSaleRecordView:CreateTableCell()
    local tableCellSize = cc.size(800, 58)
    local tableCell =   CTableViewCell:new()
    tableCell:setContentSize(tableCellSize)
    local cellLayout = newLayer(800/2, 58/2,
                                { ap = display.CENTER, color = cc.r4b(0), size = cc.size(800, 58), enable = true })
    tableCell:addChild(cellLayout)
    local dataeLabel = newLabel(65, 25,
                             fontWithColor(  '16', { ap = display.CENTER,  text = "", fontSize = 24, tag = 32 }))
    cellLayout:addChild(dataeLabel)

    local foodName = newLabel(282, 25,
                              fontWithColor(  '16', { ap = display.CENTER, text = "", fontSize = 24, tag = 32 }))
    cellLayout:addChild(foodName)

    local priceLabel = display.newRichLabel(488, 25,
                                  { ap = display.CENTER,  c = { fontWithColor('14', {text = ""})} })
    cellLayout:addChild(priceLabel)

    local sallNumLabel = newLabel(711, 25,
                                  fontWithColor(  '16', { ap = display.CENTER,  text = "", fontSize = 24, tag = 32 }))
    cellLayout:addChild(sallNumLabel)
    tableCell.viewData = {
        dataeLabel = dataeLabel ,
        foodName = foodName ,
        priceLabel = priceLabel ,
        sallNumLabel = sallNumLabel
    }
    return  tableCell
end

return AnniversalSaleRecordView
