---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xingweihao.
--- DateTime: 28/02/2018 2:41 PM
---


local GameScene = require( 'Frame.GameScene' )
---@type UIManager
local uiMgr = AppFacade.GetInstance():GetManager("UIManager")
---@class TastingTourZoneStarRewardView :GameScene
local TastingTourZoneStarRewardView = class('TastingTourZoneStarRewardView', GameScene)
local RES_DICT = {
    BG_IMAGE = _res('ui/tastingTour/stage/fish_travel_point_bg'),
    FRAME_SP = _res('ui/tastingTour/stage/fish_travel_point_bg_frame'),
    LABEL_SP = _res('ui/tastingTour/stage/fish_travel_point_label'),
    LINE_SP  = _res('ui/tastingTour/stage/fish_travel_point_line'),
    ICON     = _res('ui/tastingTour/stage/fish_travel_ico_star')
}

function TastingTourZoneStarRewardView:ctor()
    self.super.ctor(self,'home.TastingTourZoneStarRewardView')

    self:InitUI()
end
--==============================--
--desc:初始化界面
--time:2017-08-01 03:13:56
--@return
--==============================--
function TastingTourZoneStarRewardView:InitUI()
    local closeLayer = display.newLayer(0,0,{ ap = display.CENTER , color = cc.c4b(0,0,0,170) , enable =  true })
    closeLayer:setPosition(display.center)
    self:addChild(closeLayer)

    local bgImage = display.newImageView(RES_DICT.BG_IMAGE)
    local bgSize = bgImage:getContentSize()
    local bgLayout = display.newLayer(display.width/2 , display.height/2, { ap = display.CENTER ,  size =bgSize})
    bgLayout:addChild(bgImage)

    bgImage:setPosition(cc.p(bgSize.width/2, bgSize.height/2))
    self:addChild(bgLayout)

    local centerSize = cc.size(600, 650)
    local centerLayer = display.newLayer(bgSize.width /2 + 95 , bgSize.height -170 , { ap = display.CENTER_TOP , size = centerSize})
    bgLayout:addChild(centerLayer)

    local richLabel  = display.newRichLabel(0, centerSize.height -50 ,
                { ap = display.LEFT_CENTER,r = true , c= {
                    fontWithColor('10', {text= "", fontSize = 24 , color = "#5b3c24"}),
                }})
    centerLayer:addChild(richLabel)
    CommonUtils.AddRichLabelTraceEffect(richLabel , nil , nil ,{2})
    local label = display.newLabel(centerSize.width - 25 , centerSize.height -50 ,
                           {reqW = 350  ,  ap = display.RIGHT_CENTER, fontSize= 24, color ="#5b3c25" , text =__("达成条件即可获得")})
    centerLayer:addChild(label)
    local swallowLayer = display.newLayer(centerSize.width/2 , centerSize.height/2, { ap = display.CENTER , enable = true , color = cc.c4b(0,0,0,0) , size = centerSize})
    centerLayer:addChild(swallowLayer)
    local listSize = cc.size(600,550)
    local rewardList = CListView:create(listSize)
    rewardList:setDirection(eScrollViewDirectionVertical)
    rewardList:setAnchorPoint(display.LEFT_BOTTOM)
    rewardList:setPosition(cc.p(0, 0))
    centerLayer:addChild(rewardList)
    self.viewData = {
        bgLayout    = bgLayout,
        centerSize  = centerSize,
        rewardList  = rewardList,
        centerLayer = centerLayer,
        richLabel   = richLabel,
        closeLayer  = closeLayer
    }
end
--[[
    创建第一个Cell
--]]
function TastingTourZoneStarRewardView:CreateOneCell(data)
    data = data or {}
    local point = data.starNum
    local frameImage = display.newImageView(RES_DICT.FRAME_SP)
    local frameImageSize = frameImage:getContentSize()
    frameImageSize = cc.size(frameImageSize.width, frameImageSize.height +5)
    local frameLayout = display.newLayer(frameImageSize.width/2 ,frameImageSize.height/2 ,
                                         {ap = display.CENTER , size = frameImageSize , color1 = cc.r4b()} )
    frameImage:setPosition(cc.p(frameImageSize.width/2 , frameImageSize.height/2))
    frameLayout:addChild(frameImage)

    -- 添加icon

    local leftSize = cc.size(150, 95)
    -- 左侧的叙述
    local offset = 5
    local leftLayout = display.newLayer(35 , frameImageSize.height/2  , { ap = display.LEFT_CENTER , color1 = cc.r4b()  , size = leftSize})
    local label = display.newLabel(0, leftSize.height - 15 -offset, fontWithColor('10' , {color = "#8c6648" ,  ap = display.LEFT_CENTER , text = __('厨师星标达到')}))
    leftLayout:addChild(label)



    local spLine = display.newImageView(RES_DICT.LINE_SP , 0,leftSize.height - 28 -offset  , { ap = display.LEFT_CENTER})
    leftLayout:addChild(spLine)
    frameLayout:addChild(leftLayout)


    local  labelSp = display.newImageView(RES_DICT.LABEL_SP , 0,leftSize.height - 47 - offset  , { ap = display.LEFT_CENTER})
    leftLayout:addChild(labelSp)

    local iconImage = display.newImageView(RES_DICT.ICON, 90,leftSize.height -47 -offset, {ap = display.LEFT_CENTER})
    leftLayout:addChild(iconImage)
    iconImage:setScale(0.6)
    
    local starPoint = display.newLabel(5, leftSize.height - 47-offset , fontWithColor('14' , { fontSize = 22, color = "#fff3cc" , outline = "#774013" ,   ap = display.LEFT_CENTER , text = point}))
    leftLayout:addChild(starPoint)
    local rewardLabel = display.newLabel(0, leftSize.height - 80-offset , fontWithColor('10' , { color = "#786d6d", ap = display.LEFT_CENTER , text = __('可获得:')}))
    leftLayout:addChild(rewardLabel)
    local reward = data.rewards or {}
    local goodSize = cc.size(95,100)
    local goodLayout = display.newLayer(245, frameImageSize.height/2,{
        ap = display.LEFT_CENTER , size = cc.size(goodSize.width * #reward ,goodSize.height   )
    })
    for i, v in pairs(reward) do
        local goodsIcon = require('common.GoodNode').new({id = reward[i].goodsId, amount = reward[i].num, showAmount = true })
        goodsIcon:setAnchorPoint(display.CENTER)
        goodsIcon:setPosition(cc.p((i - 0.5 )* goodSize.width, goodSize.height/2 ))
        goodLayout:addChild(goodsIcon)
        goodsIcon:setScale(0.8)
        display.commonUIParams(goodsIcon, {animate = false, cb = function (sender)
            uiMgr:ShowInformationTipsBoard({targetNode = sender, iconId = reward[i].goodsId, type = 1})
        end})
    end
    frameLayout:addChild(goodLayout)

    local rewardBtn = display.newButton(frameImageSize.width - 15 , frameImageSize.height/2 ,
                                        {
                                            ap = display.RIGHT_CENTER ,
                                            n =_res('ui/common/common_btn_orange') ,

                                        })
    rewardBtn:setTag(checkint(data.id))
    display.commonLabelParams(rewardBtn, fontWithColor('14' ,{ text = __('领取')}) )
    frameLayout:addChild(rewardBtn)
    local cellLayout = display.newLayer(frameImageSize.width/2, frameImageSize.height/2 , {ap = display.CENTER ,size = frameImageSize , color1 = cc.r4b()  })
    cellLayout:addChild(frameLayout)
    frameLayout:setPosition(cc.p(frameImageSize.width/2 ,frameImageSize.height/2))
    cellLayout.viewData = {
        frameLayout = frameLayout ,
        rewardBtn = rewardBtn ,
    }
    return cellLayout
end




return TastingTourZoneStarRewardView
