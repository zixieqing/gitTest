---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xingweihao.
--- DateTime: 2018/10/12 3:27 PM
---
local GameScene = require( 'Frame.GameScene' )
---@class AnniversaryMainView
local AnniversaryMainView = class('AnniversaryMainView' , GameScene)
local newImageView        = display.newImageView
local newLabel            = display.newLabel
local newNSprite          = display.newNSprite
local newButton           = display.newButton
local newLayer            = display.newLayer
local RES_DICT            = {
    COMMON_BTN_TIPS              = app.anniversaryMgr:GetResPath('ui/common/common_btn_tips.png'),
    ANNI_MAIN_BTN_MAINTASK_FRAME = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_maintask_frame.png'),
    ANNI_MAIN_LABEL_TIMER        = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_timer.png'),
    ANNI_MAIN_BTN_STALL          = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_stall.png'),
    TEMP_ANIME_BOX               = app.anniversaryMgr:GetResPath('ui/anniversary/temp_anime_box.png'),
    ANNI_MAIN_BTN_RANK           = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_rank.png'),
    TEMP_ANIME_SELLING           = app.anniversaryMgr:GetResPath('ui/anniversary/temp_anime_selling.png'),
    ANNI_MAIN_BTN_REWARDS        = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_rewards.png'),
    ANNI_MAIN_BTN_SUBTASK        = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_subtask.png'),
    ANNI_MAIN_LINE_1             = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_line_1.png'),
    ANNI_MAIN_BTN_STORY          = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_story.png'),
    ANNI_MAIN_BG_DAY             = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_bg_day.jpg'),
    ANNI_MAIN_BTN_MAINTASK_UNDER = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_maintask_under.png'),
    ANNI_MAIN_BTN_DRAW           = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_draw.png'),
    ANNI_MAIN_LABEL_LOCK         = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_lock.png'),
    COMMON_BTN_BACK              = app.anniversaryMgr:GetResPath('ui/common/common_btn_back.png'),
    ANNI_MAIN_LABEL_2            = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_2.png'),
    ANNI_MAIN_LABEL_1            = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_1.png'),
    ANNI_MAIN_LABEL_PLAY         = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_play.png'),
    ANNI_MAIN_LABEL_TITLE        = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_title_n.png'),
    ANNI_MAIN_BTN_MAINTASK_MASK  = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_btn_maintask_mask.png'),
    ANNI_MAIN_BG_UP              = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_bg_up.png'),
    ANNI_MAIN_LABEL_NUM          = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_label_num.png'),
    COMMON_TITLE                 = app.anniversaryMgr:GetResPath('ui/common/common_title.png'),
    ANNI_MAIN_BG_NIGHT           = app.anniversaryMgr:GetResPath('ui/anniversary/main/anni_main_bg_night.jpg')
}

function AnniversaryMainView:ctor(...)
    local view    = newLayer(display.cx, display.cy, { ap = display.CENTER, size = display.size })
    self:addChild(view)
    local bgImage = newImageView(RES_DICT.ANNI_MAIN_BG_DAY, display.cx, display.cy ,
                               { ap = display.CENTER, tag = 143 })
    bgImage:setScale(1, 1)
    view:addChild(bgImage,-1)
    self.bgImage = bgImage
    if app.anniversaryMgr.skinMode  == "one" then
        local bgSpine = SpineCache(SpineCacheName.ANNIVERSARY):createWithName(app.anniversaryMgr.spineTable.ANNI_MAIN_UP_TOP)
        view:addChild(bgSpine , 0)
        bgSpine:setAnimation(0,'idle',true)
        bgSpine:setPosition(display.width/2 , display.height - 325)
        bgSpine:setAnchorPoint(display.CENTER_TOP)
        local bgSpine = SpineCache(SpineCacheName.ANNIVERSARY):createWithName(app.anniversaryMgr.spineTable.ANNI_MAIN_UP_BOTTOM)
        view:addChild(bgSpine , 0)
        bgSpine:setAnimation(0,'idle',true)
        bgSpine:setPosition(display.width/2 ,375 )
        local ffall = SpineCache(SpineCacheName.ANNIVERSARY):createWithName(app.anniversaryMgr.spineTable.FFALL)
        view:addChild(ffall , 0)
        ffall:setPosition(display.width/2 ,375 )
        ffall:setAnimation(0,'idle',true)

    else
        local bgSpine = SpineCache(SpineCacheName.ANNIVERSARY):createWithName(app.anniversaryMgr.spineTable.ANNI_MAIN_UP)
        view:addChild(bgSpine , 100)
        bgSpine:setAnimation(0,'500101_1',true)
        bgSpine:setPosition(display.width/2 , display.height/2 )

        local topImage = display.newImageView(RES_DICT.ANNI_MAIN_BG_UP , display.width/2 , display.height  , {ap = display.CENTER_TOP})
        view:addChild(topImage)

    end

    local swallowLayer    = newLayer(display.cx, display.cy, { ap = display.CENTER, size = display.size , color = cc.c4b(0,0,0,0) ,enable = true  })
    view:addChild(swallowLayer)

    local topLayout = newLayer(1334, 750,
                               { ap = display.RIGHT_TOP, size = cc.size(380, 150) })
    topLayout:setPosition(display.SAFE_R + 0, display.height + 0)
    view:addChild(topLayout,2)

    local rewardPre = newButton(80, 80, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_1, d = RES_DICT.ANNI_MAIN_LABEL_1, s = RES_DICT.ANNI_MAIN_LABEL_1, tag = 166 })
    display.commonLabelParams(rewardPre, { text = "", fontSize = 14, color = '#414146' })
    topLayout:addChild(rewardPre)

    local oneImage = newNSprite(RES_DICT.ANNI_MAIN_BTN_REWARDS, 59, 81,
                                { ap = display.CENTER, tag = 168 })
    oneImage:setScale(1, 1)
    rewardPre:addChild(oneImage)

    local rewaedLabel = newLabel(57, 47,
                                 fontWithColor(14, { ap = display.CENTER, color = '#ffffff', text = app.anniversaryMgr:GetPoText(__('奖励预览')), fontSize = 24, tag = 169 }))
    rewardPre:addChild(rewaedLabel)

    local rankBtn = newButton(201, 80, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_2, d = RES_DICT.ANNI_MAIN_LABEL_2, s = RES_DICT.ANNI_MAIN_LABEL_2, tag = 178 })
    display.commonLabelParams(rankBtn, { text = "", fontSize = 14, color = '#414146' })
    topLayout:addChild(rankBtn)

    local rankImage = newNSprite(RES_DICT.ANNI_MAIN_BTN_RANK, 59, 81,
                                 { ap = display.CENTER, tag = 179 })
    rankImage:setScale(1, 1)
    rankBtn:addChild(rankImage)

    local rankLabel = newLabel(57, 47,
                               fontWithColor(14, { ap = display.CENTER, color = '#ffffff', text = app.anniversaryMgr:GetPoText(__('排行榜')), fontSize = 24, tag = 180 }))
    rankBtn:addChild(rankLabel)

    local plotBtn = newButton(320, 80, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_1, d = RES_DICT.ANNI_MAIN_LABEL_1, s = RES_DICT.ANNI_MAIN_LABEL_1, tag = 181 })
    display.commonLabelParams(plotBtn, { text = "", fontSize = 14, color = '#414146' })
    topLayout:addChild(plotBtn)

    local plotImage = newNSprite(RES_DICT.ANNI_MAIN_BTN_STORY, 59, 81,
                                 { ap = display.CENTER, tag = 182 })
    plotImage:setScale(1, 1)
    plotBtn:addChild(plotImage)

    local plotLabel = newLabel(57, 47,
                               fontWithColor(14, { ap = display.CENTER, color = '#ffffff', text = app.anniversaryMgr:GetPoText(__('剧情')), fontSize = 24, tag = 183 }))
    plotBtn:addChild(plotLabel)

    local backBtn = newImageView(RES_DICT.COMMON_BTN_BACK, 56, 695,
                                 { ap = display.CENTER, tag = 210, enable = true, cb = function()
                                     self:removeFromParent()
                                 end })

    backBtn:setScale(1, 1)
    backBtn:setPosition(display.SAFE_L + 56, display.height + -55)
    view:addChild(backBtn)

    local tabNameLabel = display.newButton(97, 744, { ap = display.LEFT_TOP ,  n = RES_DICT.COMMON_TITLE, d = RES_DICT.COMMON_TITLE, s = RES_DICT.COMMON_TITLE, scale9 = true, size = cc.size(303, 78) })
    display.commonLabelParams(tabNameLabel, {text = "", fontSize = 14, color = '#414146'})
    tabNameLabel:setPosition(display.cx + -570, display.height + -6)
    view:addChild(tabNameLabel ,101)

    local moduleName = display.newLabel(138, 30,
                                        fontWithColor('14' , { outline = false ,  ap = display.CENTER, color = '#5b3c25', text = app.anniversaryMgr:GetPoText(__('庆典')), fontSize = 30, tag = 71 }))
    tabNameLabel:addChild(moduleName)

    local tipButton = display.newNSprite(RES_DICT.COMMON_BTN_TIPS, 237, 30,
                                         { ap = display.CENTER, tag = 72 })
    tipButton:setScale(1, 1)
    tabNameLabel:addChild(tipButton)

    self.viewData =  {
        view        = view,
        topLayout   = topLayout,
        rewardPre   = rewardPre,
        oneImage    = oneImage,
        rewaedLabel = rewaedLabel,
        rankBtn     = rankBtn,
        rankImage   = rankImage,
        rankLabel   = rankLabel,
        plotBtn     = plotBtn,
        plotImage   = plotImage,
        plotLabel   = plotLabel,
        backBtn     = backBtn,
        tabNameLabel = tabNameLabel ,
    }
end

function AnniversaryMainView:CreateBlockMarketLayout()
    local view        = self.viewData.view
    local blockMarket = newLayer(179, 66,
                                 { ap = display.LEFT_BOTTOM, color = cc.r4b(0), size = cc.size(200, 200), enable = true })
    blockMarket:setPosition(display.cx - 488 , display.cy  -290)
    view:addChild(blockMarket)
    blockMarket:setVisible(false)
    blockMarket:setName("blockMarket")
    local marketImage = newImageView(RES_DICT.ANNI_MAIN_BTN_STALL, 93, 119,
                                     { ap = display.CENTER, tag = 159, enable = false })
    blockMarket:addChild(marketImage)
    local titleBtn = newButton(101, 9, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_TITLE, d = RES_DICT.ANNI_MAIN_LABEL_TITLE, s = RES_DICT.ANNI_MAIN_LABEL_TITLE, tag = 162 })
    display.commonLabelParams(titleBtn, fontWithColor(14, { text = app.anniversaryMgr:GetPoText(__('摊位')),  offset = cc.p( 0 ,4) , fontSize = 23 ,outline = '#591f1f' , color = '#ffffff' }))
    blockMarket:addChild(titleBtn)
    --local statusImage = newImageView(RES_DICT.TEMP_ANIME_BOX, 26, 107,
    --                                 { ap = display.CENTER, tag = 160, enable = false })
    --blockMarket:addChild(statusImage)

    --local sallingIMage = newNSprite(RES_DICT.TEMP_ANIME_SELLING, 212, 84,
    --                                { ap = display.CENTER, tag = 163 })
    --sallingIMage:setScale(1, 1)
    --blockMarket:addChild(sallingIMage)

    local statusBtn = newButton(101, -41, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_TIMER, d = RES_DICT.ANNI_MAIN_LABEL_TIMER, s = RES_DICT.ANNI_MAIN_LABEL_TIMER, scale9 = true, size = cc.size(270, 33), tag = 164 })
    display.commonLabelParams(statusBtn, { text = app.anniversaryMgr:GetPoText(__('领取收益')), fontSize = 24, color = '#854e28' })
    blockMarket:addChild(statusBtn)

    local distanceStartLanel = display.newRichLabel(135 , 16.5 , { c= {
        fontWithColor(14, {text = ""})
    }})
    statusBtn:addChild(distanceStartLanel)
    blockMarket.viewData = {
        blockMarket  = blockMarket,
        titleBtn     = titleBtn,
        marketImage  = marketImage,
        --statusImage  = statusImage,
        --sallingIMage = sallingIMage,
        statusBtn    = statusBtn,
        distanceStartLanel = distanceStartLanel ,
    }
    return blockMarket
end

function AnniversaryMainView:CreateMySteriousLayout()
    local view           = self.viewData.view
    local mysteriousRing = newLayer(892, 89,
                                    { ap = display.LEFT_BOTTOM, color = cc.r4b(0), size = cc.size(200, 200), enable = true })
    mysteriousRing:setPosition(display.cx + 350, display.cy -266)
    view:addChild(mysteriousRing)
    mysteriousRing:setName("mysteriousRing")

    local mysteriousImage = newImageView(RES_DICT.ANNI_MAIN_BTN_DRAW, 109, 132,
                                         { ap = display.CENTER, tag = 186, enable = false })
    mysteriousRing:addChild(mysteriousImage)
    mysteriousRing:setVisible(false)
    local titleBtn = newButton(101, 9, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_TITLE, d = RES_DICT.ANNI_MAIN_LABEL_TITLE, s = RES_DICT.ANNI_MAIN_LABEL_TITLE,  tag = 185 })
    display.commonLabelParams(titleBtn, fontWithColor(14, { offset = cc.p( 0 ,4) , text =app.anniversaryMgr:GetPoText(__('神秘套圈')), fontSize = 24, color = '#ffffff' , outline = '#591f1f' }))
    mysteriousRing:addChild(titleBtn)

    local statuBtn = newButton(101, -36, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_NUM, d = RES_DICT.ANNI_MAIN_LABEL_NUM, s = RES_DICT.ANNI_MAIN_LABEL_NUM, scale9 = true, size = cc.size(270, 33), tag = 189 })
    display.commonLabelParams(statuBtn,  { text = "", fontSize = 20, color = '#ffffff' })
    mysteriousRing:addChild(statuBtn)

    require('common.RemindIcon').addRemindIcon({parent = mysteriousImage, tag = RemindTag.ANNIVERSARY_EXTRA_REWARD_TIP, po = cc.p(mysteriousImage:getContentSize().width - 28, mysteriousImage:getContentSize().height - 78)})

    local holdLabel = newLabel(58, 14,
                               { ap = display.CENTER, color = '#ffffff', text = app.anniversaryMgr:GetPoText(__('持有')), fontSize = 20, tag = 190 })
    statuBtn:addChild(holdLabel)
    local goldRichLabl = display.newRichLabel(250 , 16.5, {
        ap = display.RIGHT_CENTER , c= {
            fontWithColor('14' ,{})
        }
    })
    statuBtn:addChild(goldRichLabl)

    mysteriousRing.viewData = {
        mysteriousRing  = mysteriousRing,
        mysteriousImage = mysteriousImage,
        titleBtn        = titleBtn,
        statuBtn        = statuBtn,
        holdLabel       = holdLabel,
        goldRichLabl    = goldRichLabl ,
    }
    return mysteriousRing
end
function AnniversaryMainView:CreateBranchLineLayout()
    local view     = self.viewData.view
    local branchLine = newLayer(599, 254,
                              { ap = display.LEFT_BOTTOM, color = cc.r4b(0), size = cc.size(200, 200), enable = true })
    branchLine:setPosition(display.cx + -68, display.cy - 270 )
    view:addChild(branchLine)
    branchLine:setName("branchLine")
    branchLine:setVisible(false)
    local goldenSpine = SpineCache(SpineCacheName.ANNIVERSARY):createWithName(app.anniversaryMgr.spineTable.ANNI_FEICHUAN)
    goldenSpine:setAnimation(0, 'idle', true)
    goldenSpine:setScale(1.2)
    branchLine:addChild(goldenSpine)
    goldenSpine:setTimeScale(0.5)
    goldenSpine:setPosition(100, -194)
    local branchLineIMage = newImageView(RES_DICT.ANNI_MAIN_BTN_SUBTASK, 93, 89,
                                       { ap = display.CENTER, tag = 197, enable = false })
    branchLine:addChild(branchLineIMage)

    local titleBtn = newButton(90, 23, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_TITLE, d = RES_DICT.ANNI_MAIN_LABEL_TITLE, s = RES_DICT.ANNI_MAIN_LABEL_TITLE,  tag = 193 })
    display.commonLabelParams(titleBtn, fontWithColor(14, { text =  app.anniversaryMgr:GetPoText(__('游玩庆典')), fontSize = 24, color = '#ffffff'  , outline = '#591f1f' ,offset = cc.p(0, -5)}))
    branchLine:addChild(titleBtn)

    local lineImage = newImageView(RES_DICT.ANNI_MAIN_LINE_1, 103, 35,
                                   { ap = display.CENTER, tag = 198, enable = false })
    branchLine:addChild(lineImage)

    local areaLabel = newLabel(84, 50,
                             fontWithColor( 14, { ap = display.CENTER, color = '#e7c898', text = app.anniversaryMgr:GetPoText(__('格瑞洛舞台区')), fontSize = 20, tag = 199 }))
    branchLine:addChild(areaLabel)
    local statuBtn = newButton(91, -27, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_PLAY, d = RES_DICT.ANNI_MAIN_LABEL_PLAY, s = RES_DICT.ANNI_MAIN_LABEL_PLAY, scale9 = true, size = cc.size(289, 32), tag = 194 })
    display.commonLabelParams(statuBtn, { text = app.anniversaryMgr:GetPoText(__('进行中')), fontSize = 20, color = '#fae1b2' })
    branchLine:addChild(statuBtn)
    branchLine.viewData = {
        branchLine      = branchLine,
        branchLineIMage = branchLineIMage,
        titleBtn      = titleBtn,
        lineImage     = lineImage,
        areaLabel     = areaLabel,
        statuBtn      = statuBtn,
    }
    return branchLine
end

function AnniversaryMainView:CreateMainLineLayout()
    local view     = self.viewData.view
    local mainlineIcon = newLayer(652, 477,
                                  { ap = display.CENTER,size = cc.size(200, 200) })
    mainlineIcon:setPosition(display.cx + -15, display.cy + 102)
    view:addChild(mainlineIcon , 2)
    local mainlineIconTouch =newLayer(200/2, 200/2,
                                      { ap = display.CENTER,size = cc.size(200, 250) , enable = true , color = cc.c4b(0,0,0,0)})
    mainlineIcon:addChild(mainlineIconTouch, 20 )
    --mainlineIcon:setCascadeOpacityEnabled(true)
    mainlineIcon:setVisible(false)
    mainlineIcon:setName("mainlineIcon")

    local underImage = newImageView(RES_DICT.ANNI_MAIN_BTN_MAINTASK_UNDER, 88, 107,
                                    { ap = display.CENTER, tag = 202, enable = false })
    mainlineIcon:addChild(underImage)
    local mainLineBgCardIMage = newImageView(RES_DICT.ANNI_MAIN_BTN_MAINTASK_FRAME, 85, 104,
                                             { ap = display.CENTER, tag = 203, enable = false })
    mainlineIcon:addChild(mainLineBgCardIMage)
    local  clipNodeTable =  self:CreateClipNode()
    clipNodeTable.parentLayout:setPosition( 88, 107 )
    mainlineIcon:addChild(clipNodeTable.parentLayout)

    local mainLineIMageStatus = newImageView(RES_DICT.ANNI_MAIN_BTN_MAINTASK_MASK, 91, 104,
                                             { ap = display.CENTER, tag = 205, enable = false })
    mainlineIcon:addChild(mainLineIMageStatus)
    mainLineIMageStatus:setVisible(false)
    local titleBtn = newButton(90, 23, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_TITLE, d = RES_DICT.ANNI_MAIN_LABEL_TITLE, s = RES_DICT.ANNI_MAIN_LABEL_TITLE, tag = 206  })
    display.commonLabelParams(titleBtn, fontWithColor(14, {outlineSize = 2 ,  text = app.anniversaryMgr:GetPoText(__('主线')) , outline = '#591f1f' ,fontSize = 24, color = '#ffffff' , offset =cc.p(0, -5) }))
    mainlineIcon:addChild(titleBtn)

    local lineImage = newImageView(RES_DICT.ANNI_MAIN_LINE_1, 103, 35,
                                   { ap = display.CENTER, tag = 207, enable = false })
    mainlineIcon:addChild(lineImage)

    local areaLabel = newLabel(84, 50,
                              fontWithColor(14, {  outlineSize = 2 , ap = display.CENTER, color = '#e7c898',  text = app.anniversaryMgr:GetPoText(__('主线')), fontSize = 20, tag = 208 }))
    mainlineIcon:addChild(areaLabel)

    local statuBtn = newButton(91, -27, { ap = display.CENTER, n = RES_DICT.ANNI_MAIN_LABEL_PLAY, d = RES_DICT.ANNI_MAIN_LABEL_PLAY, s = RES_DICT.ANNI_MAIN_LABEL_PLAY, scale9 = true, size = cc.size(289, 32), tag = 209 })
    display.commonLabelParams(statuBtn, { text = app.anniversaryMgr:GetPoText(__('进行中')), fontSize = 20, color = '#fae1b2' })
    mainlineIcon:addChild(statuBtn)

    local  mainWalkingSpine = SpineCache(SpineCacheName.ANNIVERSARY):createWithName(app.anniversaryMgr.spineTable.ANNI_MAIN_WALKING)
    mainWalkingSpine:setPosition(display.center)
    view:addChild(mainWalkingSpine)
    mainWalkingSpine:setToSetupPose()
    mainWalkingSpine:setVisible(false)

    local unlockInfoBtn = display.newButton(91, -27 , { ap = display.CENTER , n = RES_DICT.ANNI_MAIN_LABEL_LOCK})
    display.commonLabelParams(unlockInfoBtn , fontWithColor(10 ,  {fontSize = 20,  color = '#ffffff', text = ""}))
    mainlineIcon:addChild(unlockInfoBtn)
    unlockInfoBtn:setVisible(false)

    mainlineIcon.viewData = {
        mainlineIcon        = mainlineIcon,
        underImage          = underImage,
        mainlineIconTouch          = mainlineIconTouch,
        mainLineBgCardIMage = mainLineBgCardIMage,
        mainLineIMageStatus = mainLineIMageStatus,
        titleBtn            = titleBtn,
        lineImage           = lineImage,
        areaLabel           = areaLabel,
        unlockInfoBtn            = unlockInfoBtn ,
        headIcon            = clipNodeTable.headIcon,
        mainTaskMaskImage    = clipNodeTable.mainTaskMaskImage,
        statuBtn            = statuBtn,
        mainWalkingSpine    = mainWalkingSpine,
    }
    return mainlineIcon
end
function AnniversaryMainView:CreateClipNode()
    local size = cc.size(120,120)
    local parentLayout =  CLayout:create(size)
    --parentLayout:setPosition(size.width/2 , size.height/2)
    local eventNode = CLayout:create(size)
    eventNode:setCascadeOpacityEnabled(true)
    eventNode:setPosition(utils.getLocalCenter(parentLayout))
    parentLayout:addChild(eventNode)
    -- 裁剪节点
    local sceneClipNode = cc.ClippingNode:create()
    sceneClipNode:setCascadeOpacityEnabled(true)
    sceneClipNode:setContentSize(size)
    sceneClipNode:setAnchorPoint(cc.p(0.5, 0.5))
    sceneClipNode:setPosition(utils.getLocalCenter(eventNode))
    eventNode:addChild(sceneClipNode, 3)
    local stencilLayer = display.newLayer(0, 0, {  size = size})
    stencilLayer:setCascadeOpacityEnabled(true)
    sceneClipNode:setInverted(false)
    sceneClipNode:setAlphaThreshold(0.1)
    sceneClipNode:setStencil(stencilLayer)
    local mask = display.newImageView(app.anniversaryMgr:GetResPath('ui/home/handbook/pokedex_card_bg_skin_head_unlock.png'), size.width/2, size.height/2 - 2)
    stencilLayer:addChild(mask)
    -- 头像
    local headIcon = display.newImageView( AssetsUtils.GetCardHeadPath(200002), size.width/2, size.height/2 - 2)
    headIcon:setScale(0.6)
    local mainTaskMaskImage = display.newImageView(RES_DICT.ANNI_MAIN_BTN_MAINTASK_MASK ,size.width/2, size.height/2 - 2 )
    sceneClipNode:addChild(mainTaskMaskImage,11)
    mainTaskMaskImage:setVisible(false)
    sceneClipNode:addChild(headIcon, 10)
    return {
        eventNode = eventNode ,
        headIcon = headIcon ,
        parentLayout = parentLayout ,
        mainTaskMaskImage = mainTaskMaskImage ,
    }
end
return AnniversaryMainView
