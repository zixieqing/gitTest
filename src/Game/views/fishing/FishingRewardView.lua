---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xingweihao.
--- DateTime: 2018/8/7 2:29 PM
---
---@class FishingRewardView
local FishingRewardView = class('FishingRewardView', function()
    local node = CLayout:create(display.size)
    node:setAnchorPoint(display.CENTER)
    node.name = 'home.LimitChestGiftView1'
    node:enableNodeEvents()
    return node
end)
---@type UIManager
local uiMgr             = AppFacade.GetInstance():GetManager("UIManager")
local RES_DICT          = {
    VIP_MENU_BG = 'ui/home/fishing/vip_menu_bg.png',
    REWARD_BTN  = 'ui/common/common_btn_orange.png',
    TITLE_IMAGE = 'ui/common/common_title_5.png'
}
function FishingRewardView:ctor(...)
    -- 关闭layer
    local closeLayer = CButton:create()
    closeLayer:setContentSize(display.size)
    closeLayer:setPosition(display.center)
    local blackLayer = display.newLayer(display.width / 2, display.height / 2, { ap = display.CENTER, size = display.size, color = cc.c4b(0, 0, 0, 175), enable = true})
    closeLayer:addChild(blackLayer)
    self:addChild(closeLayer)
    closeLayer:setOpacity(0)
    local bgImage = display.newImageView(_res(RES_DICT.VIP_MENU_BG), 0, 0, { enable = true })
    local bgSize  = bgImage:getContentSize()
    bgImage:setPosition(cc.p(bgSize.width / 2, bgSize.height / 2))

    local bgLayout = display.newLayer(display.width / 2, display.height / 2, { size = bgSize, ap = display.CENTER, color1 = cc.r4b() })
    self:addChild(bgLayout)
    bgLayout:addChild(bgImage)
    bgLayout:setScaleY(0)

    local rewerdSize  = cc.size(400, 295)
    -- 奖励框
    local rewerdLayer = display.newLayer(bgSize.width / 2, bgSize.height - 40, { ap = display.CENTER_TOP, size = rewerdSize, color1 = cc.r4b() })
    bgLayout:addChild(rewerdLayer)
    local otherRewardSize  = cc.size(400, 230)
    -- 额外奖励框
    local otherRewardLayer = display.newLayer(bgSize.width / 2, 140, { color1 = cc.r4b(), size = otherRewardSize, ap = display.CENTER_BOTTOM })
    bgLayout:addChild(otherRewardLayer)
    -- 领取按钮
    local rewardBtn = display.newButton(bgSize.width / 2, 90, { n = _res(RES_DICT.REWARD_BTN), enable = true })
    bgLayout:addChild(rewardBtn)
    display.commonLabelParams(rewardBtn, fontWithColor('14', { text = __('领取') }))
    self.viewData = {
        closeLayer       = closeLayer,
        rewerdLayer      = rewerdLayer,
        otherRewardLayer = otherRewardLayer,
        rewardBtn        = rewardBtn,
        bgLayout        = bgLayout,
        blackLayer      = blackLayer,
    }
end
--[[
　　---@Description: 创建钓鱼获取到的基础奖励
　　---@param :
　  ---@return :
　　---@author : xingweihao
　　---@date : 2018/8/7 3:14 PM
--]]
function FishingRewardView:CreateRewardLayer(data)
    local rewerdLayer = self.viewData.rewerdLayer
    local rewerdSize  = rewerdLayer:getContentSize()

    local titleImage  = display.newButton(rewerdSize.width / 2, rewerdSize.height, { n = _res(RES_DICT.TITLE_IMAGE), enable = false, ap = display.CENTER_TOP })
    rewerdLayer:addChild(titleImage)
    display.commonLabelParams(titleImage, fontWithColor('8', { text = __('收获') }))

    local count = #data
    if count > 0 then
        local posTable = {}
        local count    = 0
        local line     = 0
        for i = #data, 1, -1 do
            count                   = count + 1
            posTable[#posTable + 1] = cc.p((rewerdSize.width / 2 - 180) + (count * 120), rewerdSize.height - 100 - line * 120)
            if count == 2 then
                count = 0
                line  = line + 1
            end
        end
        for i, v in pairs(data) do
            v.showAmount = true
            local goodNode = require("common.GoodNode").new(v)
            goodNode:setPosition(posTable[i])
            rewerdLayer:addChild(goodNode)
            display.commonUIParams(goodNode, { animate = false, cb = function(sender)
                uiMgr:ShowInformationTipsBoard({ targetNode = sender, iconId = v.goodsId, type = 1 })
            end })
        end
    end
end
--[[
　　---@Description: 创建钓鱼获取到额外奖励
　　---@param :
　  ---@return :
　　---@author : xingweihao
　　---@date : 2018/8/7 3:14 PM
--]]
function FishingRewardView:CreateOtherRewardLayer(data)
    local count = #data
    if count > 0 then
        local otherRewardLayer = self.viewData.otherRewardLayer
        local otherRewerdSize  = otherRewardLayer:getContentSize()

        local titleImage       = display.newButton(otherRewerdSize.width / 2, otherRewerdSize.height, { n = _res(RES_DICT.TITLE_IMAGE), enable = false, ap = display.CENTER_TOP })
        otherRewardLayer:addChild(titleImage)
        display.commonLabelParams(titleImage, fontWithColor('8', { text = __('其他收获') }))

        local oneNum = 0
        local twoNum = 0
        if count > 4 then
            oneNum = 4
            twoNum = count - oneNum
        else
            oneNum = count
        end
        local with     = 120
        local layerOne = display.newLayer(otherRewerdSize.width / 2, otherRewerdSize.height - 40, { ap = display.CENTER_TOP, color1 = cc.r4b(), size = cc.size(with * oneNum, with) })
        otherRewardLayer:addChild(layerOne)
        layerOne:setScale(0.8)
        for i = oneNum, 1, -1 do
            local v        = data[i]
            v.showAmount = true
            local goodNode = require("common.GoodNode").new(v)
            display.commonUIParams(goodNode, { animate = false, cb = function(sender)
                uiMgr:ShowInformationTipsBoard({ targetNode = sender, iconId = v.goodsId, type = 1 })
            end })
            goodNode:setPosition(with * (i - 0.5), with / 2)
            layerOne:addChild(goodNode)
        end
        if twoNum > 0 then
            local layerTwo = display.newLayer(otherRewerdSize.width / 2, otherRewerdSize.height - 140, { ap = display.CENTER_TOP, color1 = cc.r4b(), size = cc.size(with * twoNum, with) })
            otherRewardLayer:addChild(layerTwo)
            layerTwo:setScale(0.8)
            for i = count - oneNum, 1, -1 do
                local v        = data[i]
                local goodNode = require("common.GoodNode").new(v)
                goodNode:setPosition(with * (i - 0.5), with / 2)
                layerTwo:addChild(goodNode)
                display.commonUIParams(goodNode, { animate = false, cb = function(sender)
                    uiMgr:ShowInformationTipsBoard({ targetNode = sender, iconId = v.goodsId, type = 1 })
                end })
            end
        end
    end
end

return FishingRewardView

